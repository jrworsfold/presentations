<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Secret Santa</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/dracula.css" id="theme">
		<script type="text/javascript" async
		src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
		</script>

        <link rel="stylesheet" href="plugin/title-footer/title-footer.css">
		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/dracula.css" id="highlight-theme">

		<style>
		.container{
			display: flex;
		}
		.col{
			flex: 1;
		}
		</style>

<!--dracula_palette = [
    colorant"#8be9fd" # Cyan
    colorant"#ff79c6" # Pink
    colorant"#50fa7b" # Green
    colorant"#bd93f9" # Purple
    colorant"#ffb86c" # Orange
    colorant"#ff5555" # Red
    colorant"#f1fa8c" # Yellow
    colorant"#6272a4" # Comment
]-->

</head>
<body>
    <div class="reveal">
        
        <div class="slides">
            <section   data-menu-title="Title Slide">
                <h2>Have a Very Deranged Christmas</h2>
                <h4>How to do Secret Santa correctly</h4>
                <h3 style="color:#50fa7b">Jeremy Worsfold</h3>
            </section>
            <section data-menu-title="Secret Santa">
                <h4>
                <ul>
                    <li>Each person gets one other person to buy a present for</li>
                    <li>We want to do this optimally</li>
                    <li>Give away as little information as possible</li>
                    <li>Keep it fun (make sure it's well mixed)</li>
                    <li>Automate the process with the power of programming</li>
                </ul>
                </h4>
            </section>
            <section data-menu-title="Minimal Example">
                <h2>
                    Minimal example
                </h2>
                <div class="container">
                    <div class="col">
                        <div class="stretch">
                            <img data-src="secret_santa/abby.jpg" style="width:250px; border-radius: 50%;"/>
                        </div>
                        <h4 style="color: #ff79c6;">Abby</h4>
                        <div class="stretch">
                            <img data-src="secret_santa/carmen.jpg" style="width:250px; border-radius: 50%;"/>
                        </div>
                        <h4 style="color: #ff79c6;">Carmen</h4>
                    </div>
                    <div class="col">
                        <div class="stretch">
                            <img data-src="secret_santa/beth.jpeg" style="width:250px; border-radius: 50%;"/>
                        </div>
                        <h4 style="color: #ff79c6;">Beth</h4>
                        <div class="stretch">
                            <img data-src="secret_santa/dino.jpg" style="width:250px; border-radius: 50%;"/>
                        </div>
                        <h4 style="color: #ff79c6;">Dino</h4>
                    </div>
                </div>
            </section>
            <section data-menu-title="Minimal Example">
                <h2>
                    Easy method
                </h2>
                <div class="container">
                    <div class="col">
                        <p>
                            <br/>
                        </p>
                        <ul style="line-height:2.0;">
                            <li class="fragment" data-fragment-index="1">Write cards with 1-N on top and bottom</li>
                            <li class="fragment" data-fragment-index="2">Shuffle cards upside down</li>
                            <li class="fragment" data-fragment-index="3">Cut cards in half and rotate top half by one</li>
                            <li class="fragment" data-fragment-index="4">Reattach cards and everyone takes a card. Top is who you are, bottom is who you have</li>
                        </ul>
                        <h4 class = "fragment" data-fragment-index="5">
                            Dino has Beth. Beth has Carmen. Carmen has Abby. Abby has Dino.
                        </h4>
                    </div>
                    <div class="col">
                        <h4 class = "fragment" data-fragment-index="1", style="white-space: pre-line;">
                            <span style="color: #ff5555;">1234</span>
                            <span style="color: #bd93f9;">1234</span>
                        </h4>
                        <h4 class = "fragment" data-fragment-index="2", style="white-space: pre-line;">
                            <span style="color: #ff5555;">2314</span>
                            <span style="color: #bd93f9;">2314</span>
                        </h4>
                        <h4 class = "fragment" data-fragment-index="3", style="white-space: pre-line;">
                            <span style="color: #ff5555;">4231</span>
                            <span style="color: #bd93f9;">2314</span>
                        </h4>
                        <h4 class = "fragment" data-fragment-index="4", style="white-space: pre-line;">
                            <span style="color: #ff5555;">DBCA</span>
                            <span style="color: #bd93f9;">BCAD</span>
                        </h4>
                    </div>
                </div>
            </section>
            <section data-menu-title="Easy method">
                <h2>
                    Issues with the Easy method
                </h2>
                <h4>
                    This works but we end up with a <b style="color: #f1fa8c;">full</b> cycle.
                </h4>
                <h4 class="fragment">
                    If this was a larger example, you could have information about who has you. How can we get valid permutations without full cycles?
                </h4>
            </section>
            <section data-menu-title="Derangements">
                <h2>
                    Derangements
                </h2>
                <h3 style="white-space: pre-line;">
                    <span style="color: #ff5555;">ABCD</span>,	<span style="color: #ff5555;">AB</span><span style="color: #bd93f9">DC</span>,	<span style="color: #ff5555;">A</span><span style="color: #bd93f9">CB</span>D,	<span style="color: #ff5555;">A</span>CDB,	<span style="color: #ff5555;">A</span>DBC,	<span style="color: #ff5555;">A</span><span style="color: #bd93f9">D</span><span style="color: #ff5555;">C</span><span style="color: #bd93f9">B</span>,
                    <span style="color: #bd93f9">BA</span><span style="color: #ff5555;">CD</span>,	<span style="color: #bd93f9">BADC</span>,	BCA<span style="color: #ff5555;">D</span>,	<span style="color: #f1fa8c">BCDA</span>,	<span style="color: #f1fa8c">BDAC</span>,	BD<span style="color: #ff5555;">C</span>A,
                    CAB<span style="color: #ff5555;">D</span>,	<span style="color: #f1fa8c">CADB</span>,	<span style="color: #bd93f9">C</span><span style="color: #ff5555;">B</span><span style="color: #bd93f9">A</span><span style="color: #ff5555;">D</span>,	C<span style="color: #ff5555;">B</span>DA,	<span style="color: #bd93f9">CDAB</span>,	<span style="color: #f1fa8c">CDBA</span>,
                    <span style="color: #f1fa8c">DABC</span>,	DA<span style="color: #ff5555;">C</span>B,	D<span style="color: #ff5555">B</span>AC,	DB<span style="color: #ff5555;">C</span>A,	<span style="color: #f1fa8c">DCAB</span>,	<span style="color: #bd93f9">DCBA</span>.
                </h3>
                <h4>
                    Key: <span style="color: #ff5555">1-cycle</span>, <span style="color: #bd93f9">2-cycle</span>, <span style="color: #f1fa8c">&gt2-cycle</span>
                </h4>
                <h4 class="fragment" data-fragment-index="1">$4!=24, \quad d_1(4)=9, \quad d_2(4)=6$</h4>
                <h4 class="fragment" data-fragment-index="1">Where $d_k(n)$ is the number of permutations with no cycles up to $k$</h4>
            </section>
            <section data-menu-title="Counting Derangements">
                <h2>
                    Permutation matrices
                </h2>
                <p>
                    $$
                    \begin{pmatrix}
                        0 & 0 & 0 & 1 \\
                        0 & 0 & 1 & 0 \\
                        1 & 0 & 0 & 0 \\
                        0 & 1 & 0 & 0 \\
                    \end{pmatrix}
                    $$
                </p>
                <p>Conditions: $d_1(N): \mathrm{Tr}(P)=0, \quad d_1(N): \mathrm{Tr}(P)=0$</p>
                <p>We can generate these and check against the conditions. But how long will this take?</p>
            </section>
            <section>
                <h2>
                    Counting Derangements
                </h2>
                <p style="font-size: 80%;">
                    Let $S_k$ be the set of permutations with $k$ fixed positions.
                    $$
                    \begin{aligned}
                    |S_{1}\cup \dotsm \cup S_{n}|&amp;=\sum _{i}\left|S_{i}\right|-\sum _{i \lt j}\left|S_{i}\cap S_{j}\right|+\sum _{i\lt j \lt k}\left|S_{i}\cap S_{j}\cap S_{k}\right|+\cdots +(-1)^{n+1}\left|S_{1}\cap \dotsm \cap S_{n}\right|\\&amp;={n \choose 1}(n-1)!-{n \choose 2}(n-2)!+{n \choose 3}(n-3)!-\cdots +(-1)^{n+1}{n \choose n}0!\\&amp;=\sum _{i=1}^{n}(-1)^{i+1}{n \choose i}(n-i)!\\&amp;=n!\ \sum _{i=1}^{n}{(-1)^{i+1} \over i!}
                    \end{aligned}
                    $$
                </p>
                <p>Derangement is permutation with no fixed positions: $d_1(n) = n! - n!\ \sum _{i=1}^{n}{(-1)^{i+1} \over i!} =  n!\ \sum _{i=0}^{n}(-1)^{i}/i!$</p>
                <p>We can generate these and check against the conditions. But how long will this take?</p>
            </section>
            <section>
                <h2>
                    Counting Derangements
                </h2>
                <div class="container">
                    <div class="col">
                        <div class="r-stack">
                        <div class="stretch">
                            <img class="fragment" data-fragment-index="1" data-src="secret_santa/derrangements0.png" style="width:1400px;"/>
                        </div>
                        <div class="stretch">
                            <img class="fragment" data-fragment-index="2" data-src="secret_santa/derrangements1.png" style="width:1400px;"/>
                        </div>
                        </div>
                    </div>
                    <div class="col">
                        <p>
                            $d_1(n)/n!\ = \sum _{i=0}^{n}\frac{(-1)^{i}}{i!}$
                        </p>
                        <p class="fragment" data-fragment-index="1">
                            $$
                            e^{-1} = \sum _{i=0}^{\infty}\frac{(-1)^{i}}{i!} \approx d_1(n)/n!
                            $$
                        </p>
                        <p class="fragment" data-fragment-index="2">
                            $d_2(n)/n!\ \approx e^{-3/2}$
                        </p>
                    </div>
                </div>
                <h4 class="fragment" data-fragment-index="3" style="color: #bd93f9;">
                    Therefore, if we use sampling, the number of samples needed, $M$, is a geometric random variable with expectation $\mathbb{E}[M]=n!/d_2(n)\approx e^{3/2}$. 
                </h4>
                <h4 class="fragment" data-fragment-index="3" style="color: #bd93f9;">
                    Interestingly, $M$ doesn't grow with the number of people $n$.
                </h4>
            </section>
            <section>
                <h4>Therefore all we need to do is sample permutations $P$ and check they satisfy $\mathrm{Tr}(P+P^2)=0$</h4>
                <h4 style="color: #50fa7b;">Thanks for listening!</h4>
            </section>
            </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="plugin/chart/Chart.min.js"></script>
    <script src="plugin/chart/plugin.js"></script>
    <script src="plugin/math/math.js"></script>
    <script src="plugin/menu/menu.js"></script>
    <script src="plugin/chalkboard/plugin.js"></script>
    <script src="plugin/zoom/zoom.js"></script>
    <script>
        // More info about initialization & config:
        // - https://revealjs.com/initialization/
        // - https://revealjs.com/config/
        Reveal.initialize({
            hash: true,
            width: 1800,
            height: 920,
            slideNumber: 'c/t',
            //loop: true,

            margin: 0.04,

            menu: {
                titleSelector: '',
                themes: true,
                hideMissingTitles: true,
            },

            dependencies: [{ src: 'plugin/title-footer/title-footer.js', async: true, callback: function() { title_footer.initialize(); } }],

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealChart, 
                        RevealMenu, RevealChalkboard, RevealMath, RevealZoom ]
        });
    </script>
</body>
</html>
